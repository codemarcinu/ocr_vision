<!DOCTYPE html>
<html lang="pl" data-bs-theme="dark">
<script>document.documentElement.dataset.theme=localStorage.getItem('theme_pref')||'auto';</script>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#212529">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="2Brain">
  <title>{% block title %}Second Brain{% endblock %}</title>

  <link rel="manifest" href="/static/manifest.json">
  <link rel="apple-touch-icon" href="/static/icons/icon-192.png">

  <!-- Minimal CSS - custom lightweight -->
  <link rel="stylesheet" href="/static/css/mobile.css">
  {% block extra_head %}{% endblock %}
</head>
<body>
  <!-- Header -->
  <header class="app-header">
    <div class="header-left">
      <button class="icon-btn" id="history-btn" title="Historia rozmÃ³w" aria-label="Historia rozmÃ³w"><span aria-hidden="true">ğŸ“‹</span></button>
      <span class="app-logo">ğŸ§ </span>
      <span class="app-title">Second Brain</span>
    </div>
    <div class="header-right">
      <div class="header-btn-wrapper">
        <button class="icon-btn" id="settings-btn" title="Ustawienia" aria-label="Ustawienia"><span aria-hidden="true">âš™ï¸</span></button>
        <span class="offline-badge hidden" id="offline-badge">0</span>
      </div>
      <button class="icon-btn" id="push-toggle" title="Powiadomienia" aria-label="Powiadomienia"><span aria-hidden="true">ğŸ”•</span></button>
    </div>
  </header>

  <!-- Offline banner -->
  <div class="offline-banner">ğŸ“¡ Tryb offline - wiadomoÅ›ci zostanÄ… wysÅ‚ane po poÅ‚Ä…czeniu</div>
  <!-- Sync banner -->
  <div class="sync-banner"><span class="sync-spinner"></span> Synchronizacja...</div>

  <!-- Page toolbar (search, filters) - overridden by subpages -->
  {% block page_toolbar %}{% endblock %}

  <!-- Main content -->
  <main class="app-main">
    {% block content %}{% endblock %}
  </main>

  <!-- Quick actions bar (chat input) - hidden on subpages -->
  {% block quick_actions %}
  <div class="quick-actions" id="quick-actions">
    <button class="action-btn" data-action="camera" title="ZdjÄ™cie paragonu" aria-label="ZdjÄ™cie paragonu">
      <span aria-hidden="true">ğŸ“·</span>
    </button>
    <button class="action-btn" data-action="voice" title="WiadomoÅ›Ä‡ gÅ‚osowa" aria-label="WiadomoÅ›Ä‡ gÅ‚osowa">
      <span aria-hidden="true">ğŸ¤</span>
    </button>
    <button class="action-btn" data-action="attach" title="ZaÅ‚Ä…cznik" aria-label="ZaÅ‚Ä…cznik">
      <span aria-hidden="true">ğŸ“</span>
    </button>
    <div class="input-wrapper">
      <textarea id="chat-input" placeholder="Napisz..." rows="1"></textarea>
    </div>
    <div class="recording-overlay" id="recording-overlay">
      <span class="recording-timer" id="recording-timer">0:00</span>
      <div class="recording-waveform" id="recording-waveform">
        <canvas id="waveform-canvas"></canvas>
      </div>
      <button class="recording-cancel" id="recording-cancel">Anuluj</button>
    </div>
    <button class="send-btn" id="send-btn" title="WyÅ›lij" aria-label="WyÅ›lij">
      <span aria-hidden="true">â¤</span>
    </button>
  </div>
  {% endblock %}

  <!-- Bottom navigation (3 tabs) -->
  <nav class="bottom-nav" id="bottom-nav">
    <a href="/m/" class="nav-item {{ 'active' if active_page == 'chat' or not active_page }}" data-page="chat" aria-label="Czat">
      <span aria-hidden="true">ğŸ’¬</span><small>Czat</small>
    </a>
    <button class="nav-item" id="nav-history" aria-label="Historia rozmÃ³w">
      <span aria-hidden="true">ğŸ“‹</span><small>Historia</small>
    </button>
    <button class="nav-item" id="nav-more" aria-label="WiÄ™cej opcji">
      <span aria-hidden="true">â‹¯</span><small>WiÄ™cej</small>
    </button>
  </nav>

  <!-- More sheet (subpages + settings) -->
  <div class="sheet-backdrop" id="more-backdrop"></div>
  <div class="bottom-sheet" id="more-sheet">
    <div class="sheet-handle"></div>
    <h3 class="sheet-title">WiÄ™cej</h3>
    <div class="more-grid">
      <a href="/m/notatki" class="more-item {{ 'active' if active_page == 'notes' }}">
        <span class="more-item-icon">ğŸ“</span><span>Notatki</span>
      </a>
      <a href="/m/paragony" class="more-item {{ 'active' if active_page == 'receipts' }}">
        <span class="more-item-icon">ğŸ›’</span><span>Zakupy</span>
      </a>
      <a href="/m/wiedza" class="more-item {{ 'active' if active_page == 'knowledge' }}">
        <span class="more-item-icon">ğŸ“š</span><span>Wiedza</span>
      </a>
      <a href="/app/" class="more-item">
        <span class="more-item-icon">ğŸ–¥ï¸</span><span>Desktop</span>
      </a>
    </div>
  </div>

  <!-- Session history drawer -->
  <div class="drawer-backdrop" id="history-backdrop"></div>
  <div class="history-drawer" id="history-drawer">
    <div class="drawer-header">
      <h3>Historia rozmÃ³w</h3>
      <button class="mobile-btn mobile-btn-primary" id="new-chat-btn">+ Nowa</button>
    </div>
    <div class="drawer-content" id="history-list">
      <div class="mobile-empty" style="min-height: auto; padding: 2rem 1rem;">
        <div class="mobile-empty-icon">ğŸ’¬</div>
        <div class="mobile-empty-text">Åadowanie...</div>
      </div>
    </div>
  </div>

  <!-- Settings bottom sheet -->
  <div class="sheet-backdrop" id="settings-backdrop"></div>
  <div class="bottom-sheet" id="settings-sheet">
    <div class="sheet-handle"></div>
    <h3 class="sheet-title">Ustawienia</h3>
    <div class="settings-list">
      <div class="settings-item">
        <span>Motyw</span>
        <div class="theme-picker" id="theme-picker">
          <button class="theme-opt" data-theme="auto" title="Automatyczny">ğŸ”„</button>
          <button class="theme-opt" data-theme="dark" title="Ciemny">ğŸŒ™</button>
          <button class="theme-opt" data-theme="light" title="Jasny">â˜€ï¸</button>
        </div>
      </div>
      <div class="settings-item">
        <span>Ukryj nawigacjÄ™ dolnÄ…</span>
        <label class="toggle">
          <input type="checkbox" id="toggle-nav">
          <span class="slider"></span>
        </label>
      </div>
      <div class="settings-item">
        <span>Nowa sesja czatu</span>
        <button class="settings-btn" id="new-session-btn">ğŸ”„ Reset</button>
      </div>
      <div class="settings-item">
        <span>Blokada aplikacji</span>
        <label class="toggle">
          <input type="checkbox" id="toggle-lock">
          <span class="slider"></span>
        </label>
      </div>
      <div class="settings-lock-options hidden" id="lock-options">
        <div class="settings-item">
          <span>ZmieÅ„ PIN</span>
          <button class="settings-btn" id="change-pin-btn">ğŸ”‘ ZmieÅ„</button>
        </div>
        <div class="settings-item hidden" id="biometric-option">
          <span>Biometria</span>
          <label class="toggle">
            <input type="checkbox" id="toggle-biometric">
            <span class="slider"></span>
          </label>
        </div>
      </div>
    </div>
    <div class="settings-footer">
      <a href="/app/" class="settings-link">ğŸ–¥ï¸ Wersja desktop</a>
    </div>
  </div>

  <!-- File preview overlay -->
  <div class="file-preview-overlay hidden" id="file-preview">
    <div class="file-preview-card">
      <img id="file-preview-img" src="" alt="PodglÄ…d">
      <div class="file-preview-name" id="file-preview-name"></div>
      <div class="file-preview-progress hidden" id="file-preview-progress">
        <div class="file-preview-progress-bar" id="file-preview-bar"></div>
      </div>
      <div class="file-preview-actions" id="file-preview-actions">
        <button class="mobile-btn mobile-btn-primary" id="file-preview-send">ğŸ§¾ WyÅ›lij jako paragon</button>
        <button class="mobile-btn mobile-btn-ghost" id="file-preview-cancel">Anuluj</button>
      </div>
      <button class="mobile-btn mobile-btn-ghost hidden" id="file-preview-abort">Anuluj przetwarzanie</button>
    </div>
  </div>

  <!-- Attachment picker sheet -->
  <div class="sheet-backdrop" id="attach-backdrop"></div>
  <div class="bottom-sheet" id="attach-sheet">
    <div class="sheet-handle"></div>
    <h3 class="sheet-title">ZaÅ‚Ä…cznik</h3>
    <div class="attach-options">
      <button class="attach-option" id="attach-camera">
        <span class="attach-option-icon">ğŸ“·</span>
        <span>Aparat</span>
      </button>
      <button class="attach-option" id="attach-gallery">
        <span class="attach-option-icon">ğŸ–¼ï¸</span>
        <span>Galeria</span>
      </button>
      <button class="attach-option" id="attach-pdf">
        <span class="attach-option-icon">ğŸ“„</span>
        <span>PDF</span>
      </button>
      <button class="attach-option" id="attach-link">
        <span class="attach-option-icon">ğŸ”—</span>
        <span>Link</span>
      </button>
    </div>
  </div>

  <script src="/static/js/htmx.min.js"></script>
  <script src="/static/js/marked.min.js"></script>
  <script src="/static/js/purify.min.js"></script>
  <script src="/static/js/offline-queue.js"></script>
  <script src="/static/js/mobile.js"></script>
  {% block extra_scripts %}{% endblock %}
</body>
</html>
