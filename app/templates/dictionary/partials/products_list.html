<!-- Search -->
<div class="mb-3">
    <div class="input-group">
        <span class="input-group-text"><i class="bi bi-search"></i></span>
        <input type="search" class="form-control" placeholder="Szukaj produktu..."
               name="search" value="{{ search }}"
               hx-get="/app/slownik/partials/products" hx-target="#products-list"
               hx-trigger="keyup changed delay:500ms" hx-indicator="#products-loading">
        <select name="category" class="form-select" style="max-width:180px"
                hx-get="/app/slownik/partials/products" hx-target="#products-list"
                hx-trigger="change" hx-include="[name='search']" hx-indicator="#products-loading">
            <option value="">Wszystkie kategorie</option>
            {% for cat in categories %}
            <option value="{{ cat }}" {% if category == cat %}selected{% endif %}>{{ cat }}</option>
            {% endfor %}
        </select>
        <span id="products-loading" class="htmx-indicator input-group-text">
            <span class="spinner-border spinner-border-sm"></span>
        </span>
    </div>
</div>

{% if products %}
<div class="mb-2 text-muted small">Znaleziono {{ products|length }} produktow</div>
<div class="table-responsive">
    <table class="table table-sm">
        <thead>
            <tr>
                <th>Nazwa</th>
                <th>Kategoria</th>
                <th>Warianty (raw_names)</th>
                <th class="text-end">Cena typ.</th>
            </tr>
        </thead>
        <tbody>
            {% for p in products %}
            <tr>
                <td class="fw-medium">{{ p.normalized_name }}</td>
                <td><span class="badge bg-info text-dark">{{ p.category }}</span></td>
                <td>
                    <small class="text-muted">
                        {% for rn in p.raw_names[:5] %}
                        <span class="badge bg-light text-dark me-1">{{ rn }}</span>
                        {% endfor %}
                        {% if p.raw_names|length > 5 %}
                        <span class="text-muted">+{{ p.raw_names|length - 5 }}</span>
                        {% endif %}
                    </small>
                </td>
                <td class="text-end">
                    {% if p.typical_price %}
                    {{ "%.2f"|format(p.typical_price) }} zl
                    {% else %}
                    <span class="text-muted">-</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="empty-state">
    <div class="empty-state-icon"><i class="bi bi-book"></i></div>
    <p>Brak produktow w slowniku</p>
</div>
{% endif %}
